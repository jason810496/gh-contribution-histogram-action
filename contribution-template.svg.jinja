<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg width="1200" height="600" xmlns="http://www.w3.org/2000/svg">
    <!-- Define animations -->
    <defs>
        <style type="text/css">
            @keyframes drawLine {
                0% {
                    stroke-dashoffset: 2000;
                }
                100% {
                    stroke-dashoffset: 0;
                }
            }
            .animated-line {
                stroke-dasharray: 2000;
                stroke-dashoffset: 2000;
                animation: drawLine 1.5s ease-in-out forwards;
            }
            /* Remove the general animated-point class as we'll create individual dot animations */
        </style>
    </defs>
    
    <!-- Define chart background -->
    <rect x="0" y="0" width="1200" height="600" fill="{{ background_color }}"/>

    <!-- Y-axis line -->
    <line x1="100" y1="100" x2="100" y2="550" stroke="#555555" stroke-width="1.5"/>

    <!-- X-axis line -->
    <line x1="100" y1="550" x2="1100" y2="550" stroke="#555555" stroke-width="1.5"/>

    <!-- Chart grid -->
    <g stroke="#ffffff" stroke-width="1">
        {% set grid_lines = 5 %}
        {% set max_y_value = [max_authored_value, max_reviewed_value]|max * 1.1 %}
        {% for i in range(grid_lines + 1) %}
            {% set y_pos = 550 - (450 * i / grid_lines) %}
            <line x1="100" y1="{{ y_pos }}" x2="1100" y2="{{ y_pos }}" stroke-opacity="0.6"/>
        {% endfor %}
        
        {% for i in range(months|length) %}
            {% set x_pos = 100 + (1000 * i / (months|length - 1)) if months|length > 1 else 550 %}
            <line x1="{{ x_pos }}" y1="100" x2="{{ x_pos }}" y2="550" stroke-opacity="0.6"/>
        {% endfor %}
    </g>

    <!-- Y-axis numbers -->
    {% for i in range(grid_lines + 1) %}
        {% set y_pos = 550 - (450 * i / grid_lines) %}
        <text x="1112" y="{{ y_pos + 5 }}" font-family="Arial" font-size="14" text-anchor="start" fill="{{ text_color }}">{{ (max_y_value * i / grid_lines)|int }}</text>
    {% endfor %}

    <!-- Chart title -->
    <text x="600" y="50" font-family="Arial" font-size="20" text-anchor="middle" fill="{{ text_color }}">
        Contribution History of <tspan font-weight="bold">{{ username }}</tspan> in <tspan font-weight="bold">{{ repo_owner }}/{{ repo_name }}</tspan>
    </text>
    
    <!-- X-axis labels (months) -->
    {% for i in range(months|length) %}
        {% set x_pos = 100 + (1000 * i / (months|length - 1)) if months|length > 1 else 550 %}
        <text x="{{ x_pos }}" y="580" font-family="Arial" font-size="14" text-anchor="middle" transform="rotate(0, {{ x_pos }}, 580)" fill="{{ text_color }}">
            {{ months[i] }}
        </text>
    {% endfor %}
    
    <!-- Y-axis label -->
    <text x="85" y="325" font-family="Arial" font-size="16" text-anchor="middle" transform="rotate(-90, 85, 325)" font-weight="bold" fill="{{ text_color }}">
        Number of Pull Requests
    </text>
    
    <!-- Plot authored PRs line -->
    <polyline
        fill="none"
        stroke="{{ authored_color }}"
        stroke-width="3"
        class="animated-line"
        points="{% for i in range(months|length) %}
            {% set x_pos = 100 + (1000 * i / (months|length - 1)) if months|length > 1 else 550 %}
            {% set y_pos = 550 - (450 * authored_values[i] / max_y_value) if max_y_value > 0 else 550 %}
            {{ x_pos }},{{ y_pos }} {% endfor %}"
    />
    
    <!-- Plot reviewed PRs line -->
    <polyline
        fill="none"
        stroke="{{ reviewed_color }}"
        stroke-width="3"
        class="animated-line"
        points="{% for i in range(months|length) %}
            {% set x_pos = 100 + (1000 * i / (months|length - 1)) if months|length > 1 else 550 %}
            {% set y_pos = 550 - (450 * reviewed_values[i] / max_y_value) if max_y_value > 0 else 550 %}
            {{ x_pos }},{{ y_pos }} {% endfor %}"
    />
    
    <!-- Authored data points with values -->
    {% for i in range(months|length) %}
        {% set x_pos = 100 + (1000 * i / (months|length - 1)) if months|length > 1 else 550 %}
        {% set y_pos = 550 - (450 * authored_values[i] / max_y_value) if max_y_value > 0 else 550 %}
        {% set delay = 1.5 * i / (months|length) if months|length > 1 else 0.75 %}
        <circle cx="{{ x_pos }}" cy="{{ y_pos }}" r="5" fill="{{ authored_color }}" opacity="0">
            <animate attributeName="opacity" from="0" to="1" dur="0.2s" begin="{{ delay }}s" fill="freeze" />
        </circle>
    {% endfor %}
    
    <!-- Reviewed data points with values -->
    {% for i in range(months|length) %}
        {% set x_pos = 100 + (1000 * i / (months|length - 1)) if months|length > 1 else 550 %}
        {% set y_pos = 550 - (450 * reviewed_values[i] / max_y_value) if max_y_value > 0 else 550 %}
        {% set delay = 1.5 * i / (months|length) if months|length > 1 else 0.75 %}
        <circle cx="{{ x_pos }}" cy="{{ y_pos }}" r="5" fill="{{ reviewed_color }}" opacity="0">
            <animate attributeName="opacity" from="0" to="1" dur="0.2s" begin="{{ delay }}s" fill="freeze" />
        </circle>
    {% endfor %}
        
    <!-- Authored legend item -->
    <g opacity="0">
        <animate attributeName="opacity" from="0" to="1" dur="0.5s" begin="1.5s" fill="freeze" />
        <rect x="130" y="115" width="170" height="25" rx="5" ry="5" fill="{{ authored_color }}" fill-opacity="0.3" />
        <text x="140" y="132" font-family="Arial" font-size="14" fill="{{ text_color }}">
            Total PRs Authored: <tspan font-weight="bold">{{ total_authored }}</tspan>
        </text>
    </g>
    
    <!-- Reviewed legend item -->
    <g opacity="0">
        <animate attributeName="opacity" from="0" to="1" dur="0.5s" begin="2.5s" fill="freeze" />
        <rect x="130" y="145" width="170" height="25" rx="5" ry="5" fill="{{ reviewed_color }}" fill-opacity="0.3" />
        <text x="140" y="162" font-family="Arial" font-size="14" fill="{{ text_color }}">
            Total PRs Reviewed: <tspan font-weight="bold">{{ total_reviewed }}</tspan>
        </text>
    </g>
</svg>